function DUI(onload){var onloadE=onload;var rd=new IRWFile("UI.ifui");this.code=0;this.key="";this.uis={};this.ctrls={};var _sf=this;rd.onload=function(){_sf.code=rd.readInt();_sf.key=rd.readString();var length=rd.readInt();_sf.uis=[];for(var i=0;i<length;i++){var ui=new DUIMain(rd);_sf.uis[ui.id]=ui;}
length=rd.readInt();_sf.ctrls=[];for(i=0;i<length;i++){var ctrl=new DUISelfCtrl(rd);_sf.ctrls[ctrl.id]=ctrl;}
onloadE();};}
DUI.CacheUIRes=function(fileAry,loadOver){var index=0;var hash={};var isOver=false;if(fileAry.length==0){loadOver({});return;}
for(var i=0;i<fileAry.length;i++){hash[fileAry[i]]=DUI.LoadCache(fileAry[i]);}
for(var key in hash){var bitmap=hash[key];if(bitmap.complete){index+=1;if(index>=Object.keys(hash).length){loadOver(hash);}}else if(bitmap.onload==null||bitmap.onerror==null){bitmap.onload=function(){index+=1;if(index>=Object.keys(hash).length){loadOver(hash);}};bitmap.onerror=function(){index+=1;if(index>=Object.keys(hash).length){loadOver(hash);}};}else{index+=1;if(index>Object.keys(hash).length){loadOver(hash);}}}};DUI.LoadCache=function(path){if(RV.Cache[path]==null){RV.Cache[path]=RF.LoadBitmap(path);RV.Cache[path].loadTexture();return RV.Cache[path];}else{return RV.Cache[path];}};DUI.LoadCtrls=function(z,ctrl,view,_sf,obj){var endCtrl=null;if(ctrl instanceof DUIButton){endCtrl=DUI.LoadButton(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUICheck){var endCtrl=new UCheck(z,ctrl,view,_sf,obj);endCtrl.z=z+ctrl.level;endCtrl.x=0;endCtrl.y=0;}else if(ctrl instanceof DUIPic){endCtrl=DUI.LoadImage(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIRegion){endCtrl=DUI.LoadRegion(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUICtrlItem){endCtrl=DUI.LoadSelfCtrl(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIBar){endCtrl=DUI.LoadBar(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIView){endCtrl=DUI.LoadView(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIText){endCtrl=DUI.LoadText(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIAutoPic){endCtrl=DUI.LoadAutoPic(z,ctrl,view,_sf,obj);}else if(ctrl instanceof DUIGroup){endCtrl=new LCtrlGroup(_sf,ctrl,view,z);}
eval("_sf."+ctrl.key+" = endCtrl;");return endCtrl;};DUI.LoadSelfCtrl=function(z,data,view,_sf,obj){var main=RV.NowUI.ctrls[data.id];if(main!=null){var ctrl=new LCtrl(main,view,_sf,eval(data.args),data);ctrl.width=data.pwidth;ctrl.height=data.pheight;data.showIf.setOutData(_sf,obj);return ctrl;}
return null;};DUI.LoadAutoPic=function(z,data,view,_sf,obj){var ap=new UAutoPic(z,data,view);ap.width=data.width;ap.height=data.height;ap.z=z+data.level;ap.data=data;data.showIf.setOutData(_sf,obj);ap.visible=data.showIf.result();ap.opacity=data.opacity/255;return ap;};DUI.LoadText=function(z,data,view,_sf,obj){var td=data;var dText="";if(td.textType==2){dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+eval(td.text);}else{dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+td.getDrawText();}
var size=ISprite.getDrawTextSize(dText,data.isAutoLine,data.lineSize,data.lineHeight);var sp=new ISprite(IBitmap.CBitmap(size.width,size.height),view);sp.data=data;sp.lineSpacing=data.lineHeight;sp.drawText(dText,0,0,td.textStyle,td.textStyleColor.IColor(),data.isAutoLine,data.lineSize);sp.z=z+data.level;sp.zoomX=data.zoomX/100;sp.zoomY=data.zoomY/100;sp.opacity=data.opacity/255;sp.angle=data.angle;sp.tag=dText;data.showIf.setOutData(_sf,obj);sp.visible=data.showIf.result();return sp;};DUI.LoadView=function(z,data,view,_sf,obj){var viewport=new IViewport(data.x,data.y,data.width,data.height,view);viewport.data=data;viewport.z=z+data.level;data.showIf.setOutData(_sf,obj);viewport.visible=data.showIf.result();viewport.type=data.type==0?IViewport.Type.Rectangle:IViewport.Type.Round;viewport.isAutoMove=data.isAutoMove;if(data.isMove){if(data.dir==0){viewport.dir=IViewport.Dir.None;}else if(data.dir==1){viewport.dir=IViewport.Dir.Vertical;}else if(data.dir==2){viewport.dir=IViewport.Dir.Horizontal;}else if(data.dir==3){viewport.dir=IViewport.Dir.All;}}else{viewport.dir=IViewport.Dir.None;}
viewport.ctrls=[];for(var i=0;i<data.ctrls.length;i++){var ctrl=DUI.LoadCtrls(0,data.ctrls[i],viewport,_sf,obj);viewport.ctrls.push(ctrl);_sf.ctrlKeys[data.ctrls[i].key]=ctrl;}
return viewport;};DUI.LoadBar=function(z,data,view,_sf,obj){var files=data.getFiles();var bar=new IScrollbar(RF.LoadCache(files[0]),RF.LoadCache(files[1]),0,100,view);bar.data=data;bar.dir=data.dir;bar.z=z+data.level;bar.GetRect=function(){return new IRect(bar.x,bar.y,bar.x+bar.width*bar.zoomX,bar.y+bar.height*bar.zoomY);};data.showIf.setOutData(_sf,obj);bar.visible=data.showIf.result();return bar;};DUI.LoadRegion=function(z,data,view,_sf,obj){var rect=new IRect(data.x,data.y,data.x+data.width,data.y+data.height);rect.data=data;rect.GetRect=function(){return rect;};rect.long=0;rect.tempRect=new IRect(0,0,1,1);rect.slideTo=function(x,y){rect.x=x;rect.y=y;};return rect;};DUI.LoadImage=function(z,data,view,_sf,obj){var files=data.getFiles();var sp=null;if(data.userType==2){sp=new ISprite(RF.LoadCache(eval(data.script)),view);sp.canDispose=false;}else if(data.userType==3){sp=new ISprite(IBitmap.CBitmap(data.width,data.height),view);sp.canDispose=true;}else{sp=new ISprite(RF.LoadCache(files[0]),view);sp.canDispose=false;}
sp.data=data;sp.z=z+data.level;sp.zoomX=data.zoomX/100;sp.zoomY=data.zoomY/100;sp.opacity=data.opacity/255;sp.angle=data.angle;data.showIf.setOutData(_sf,obj);sp.yx=sp.yy=data.origin==0?0:0.5;sp.visible=data.showIf.result();return sp;};DUI.LoadButton=function(z,data,view,_sf,obj){var files=data.getFiles();var button=new UButton(RF.LoadCache(files[0]),RF.LoadCache(files[1]),view);if(files[2]!="System/"){button.setEnableBitmap(RF.LoadCache(files[2]));}
button.data=data;button.onload=function(){var td=data.text;var dText="";if(td.textType==2){dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+eval(td.text);}else{dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+td.getDrawText();}
var size=ISprite.getDrawTextSize(dText,false,0,1);var x=DUI.HPoint(td.x,td.HAlign,button.getBack().width,size.width);var y=DUI.VPoint(td.y,td.VAlign,button.getBack().height,size.height);button.getText().drawText(dText,x,y,td.textStyle,td.textStyleColor.IColor(),false,0);button.getText().tag=dText;button.z=z+data.level;button.zoomX=data.zoomX/100;button.zoomY=data.zoomY/100;button.opacity=data.opacity/255;button.angle=data.angle;data.showIf.setOutData(_sf,obj);data.enableIF.setOutData(_sf,obj);button.visible=data.showIf.result();button.setEnable(data.enableIF.result());};return button;};DUI.HPoint=function(tx,HAlign,w1,w2){var x=0;var tempX=0;tempX=tx;if(HAlign==0){x=tempX;}else if(HAlign==1){x=(w1-w2)/2+tempX;}else{x=(w1-w2)+tempX;}
return x;};DUI.VPoint=function(ty,VAlign,h1,h2){var y=0;var tempY=0;tempY=ty;if(VAlign==0){y=tempY;}else if(VAlign==1){y=(h1-h2)/2+tempY;}else{y=(h1-h2)+tempY;}
return y;};function DColor(rd){this.R=rd.readShort();this.G=rd.readShort();this.B=rd.readShort();this.A=rd.readShort();this.IColor=function(){return new IColor(this.R,this.G,this.B,this.A);};this.TColor=function(){return"\\c["+this.R+","+this.G+","+this.B+"]";}}
function DUIMText(rd){this.textType=rd.readShort();this.text=rd.readString();this.vid=rd.readInt();this.textStyle=rd.readShort();this.textStyleColor=new DColor(rd);this.isAutoUpdate=rd.readBool();this.fontSize=rd.readInt();this.fontColor=new DColor(rd);this.HAlign=rd.readShort();this.VAlign=rd.readShort();this.x=rd.readInt();this.y=rd.readInt();this.getDrawText=function(){var str="";if(this.textType==0){str=RF.MakerValueText(this.text);}else if(this.textType==1){str=RV.GameData.getValues(this.vid);}else{str=eval(this.text);}
return str;}}
function DUIDO(rd){this.eventType=rd.readShort();var length=rd.readInt();this.eventEvents=[];for(var i=0;i<length;i++){var e=new DEvent();e.read(rd);this.eventEvents.push(e);}
this.eventScript=rd.readString();}
function DUISelfCtrl(rd){this.id=rd.readInt();this.name=rd.readString();this.script=rd.readString();this.initEvent=new DUIDO(rd);this.initAfterEvent=new DUIDO(rd);this.updateEvent=new DUIDO(rd);this.ctrls=DUIMain.readCtrls(rd);var _sf=this;this.getFiles=function(){var files=[];for(var i=0;i<this.ctrls.length;i++){files=files.concat(this.ctrls[i].getFiles());}
return files;};this.findData=function(key){for(var i=0;i<_sf.ctrls.length;i++){if(_sf.ctrls[i].key==key){return _sf.ctrls[i];}}
return null;}}
function DUIMain(rd){this.id=rd.readInt();this.level=rd.readInt();this.name=rd.readString();this.isEsc=rd.readBool();this.isMouse=rd.readBool();this.isParallel=rd.readBool();this.isAutoStart=rd.readBool();this.startIf=new DIf(rd);this.scrpit=rd.readString();this.initEvent=new DUIDO(rd);this.initAfterEvent=new DUIDO(rd);this.updateEvent=new DUIDO(rd);this.closeEvent=new DUIDO(rd);this.ctrls=DUIMain.readCtrls(rd);var _sf=this;this.getFiles=function(){var files=[];for(var i=0;i<this.ctrls.length;i++){files=files.concat(this.ctrls[i].getFiles());}
return files;};this.findData=function(key){for(var i=0;i<_sf.ctrls.length;i++){if(_sf.ctrls[i].key==key){return _sf.ctrls[i];}}
return null;}}
DUIMain.readCtrls=function(rd){var list=[];var length=rd.readInt();for(var i=0;i<length;i++){var code=rd.readShort();if(code==1){var bt=new DUIButton(rd);list.push(bt);}else if(code==2){var bar=new DUIBar(rd);list.push(bar);}else if(code==3){var check=new DUICheck(rd);list.push(check);}else if(code==4){var view=new DUIView(rd);list.push(view);}else if(code==5){var pic=new DUIPic(rd);list.push(pic);}else if(code==6){var apic=new DUIAutoPic(rd);list.push(apic);}else if(code==7){var region=new DUIRegion(rd);list.push(region);}else if(code==8){var text=new DUIText(rd);list.push(text);}else if(code==9){var ctrl=new DUICtrlItem(rd);list.push(ctrl);}else if(code==10){var group=new DUIGroup(rd);list.push(group);}}
return list;};function DUIBar(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.pic1=rd.readString();this.pic2=rd.readString();this.userValue=rd.readShort();this.min=rd.readString();this.max=rd.readString();this.minValue=rd.readInt();this.maxValue=rd.readInt();this.previewValue=rd.readShort();this.dir=rd.readShort();this.getFiles=function(){return["System/"+this.pic1.replace("\\","/"),"System/"+this.pic2.replace("\\","/")];}}
function DUIText(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.textType=rd.readShort();this.text=rd.readString();this.vid=rd.readInt();this.textStyle=rd.readShort();this.textStyleColor=new DColor(rd);this.isAutoUpdate=rd.readBool();this.fontSize=rd.readInt();this.fontColor=new DColor(rd);this.isAutoLine=rd.readBool();this.lineSize=rd.readInt();this.lineHeight=rd.readShort()/100;this.getFiles=function(){return[];};this.getDrawText=function(){var str="";var _sf={};if(this.textType==0){str=RF.MakerValueText(this.text);}else if(this.textType==1){str=RV.GameData.getValues(this.vid);}else{str=eval(this.text);}
return str;}}
function DUIView(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.width=rd.readInt();this.height=rd.readInt();this.type=rd.readInt();this.dir=rd.readInt();this.isMove=rd.readBool();this.isAutoMove=rd.readBool();this.ctrls=DUIMain.readCtrls(rd);this.getFiles=function(){var files=[];for(var i=0;i<this.ctrls.length;i++){files=files.concat(this.ctrls[i].getFiles());}
return files;}}
function DUICheck(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.num=rd.readInt();this.defIndex=rd.readInt();this.pic1=rd.readString();this.pic2=rd.readString();this.pic3=rd.readString();this.dx=rd.readInt();this.dy=rd.readInt();this.checks=[];var length=rd.readInt();for(var i=0;i<length;i++){this.checks.push(new DUICheckMin(rd));}
this.getFiles=function(){return["System/"+this.pic1.replace("\\","/"),"System/"+this.pic2.replace("\\","/"),"System/"+this.pic3.replace("\\","/")];}}
function DUICheckMin(rd){this.text=new DUIMText(rd);this.enableIf=new DIf(rd);this.changeEvent=new DUIDO(rd);this.overEvent=new DUIDO(rd);this.visible=rd.readBool();}
function DUICtrlItem(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.id=rd.readInt();this.args=rd.readString();this.pwidth=rd.readInt();this.pheight=rd.readInt();this.getFiles=function(){var ctrl=RV.NowUI.ctrls[this.id];if(ctrl!=null){return ctrl.getFiles();}
return[];}}
function DUIGroup(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.id=rd.readInt();this.obj=rd.readString();this.ifs=new DIf(rd);this.dx=rd.readInt();this.dy=rd.readInt();this.r_num=rd.readShort();this.column=rd.readShort();this.pwidth=rd.readInt();this.pheight=rd.readInt();this.getFiles=function(){var ctrl=RV.NowUI.ctrls[this.id];if(ctrl!=null){return ctrl.getFiles();}
return[];}}
function DUIButton(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.picType=rd.readShort();this.pic1=rd.readString();this.pic2=rd.readString();this.pic3=rd.readString();this.text=new DUIMText(rd);this.enableIF=new DIf(rd);this.hoverEvent=new DUIDO(rd);this.clickEvent=new DUIDO(rd);this.downEvent=new DUIDO(rd);this.leaveEvent=new DUIDO(rd);this.getFiles=function(){if(this.picType==0){return["System/"+this.pic1.replace("\\","/"),"System/"+this.pic2.replace("\\","/"),"System/"+this.pic3.replace("\\","/")];}else{var p1=RV.GameData.getValues(parseInt(this.pic1));var p2=RV.GameData.getValues(parseInt(this.pic2));var p3=RV.GameData.getValues(parseInt(this.pic3));return["System/"+p1,"System/"+p2,"System/"+p3]}}}
function DUIPic(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.userType=rd.readShort();this.pic=rd.readString();this.script=rd.readString();this.vid=rd.readInt();this.width=rd.readInt();this.height=rd.readInt();this.origin=rd.readShort();this.preview=rd.readString();this.getFiles=function(){if(this.userType==0){return["System/"+this.pic.replace("\\","/")];}else if(this.userType==1){var p=RV.GameData.getValues(parseInt(this.vid));return["System/"+p]}else if(this.userType==2){return[]}else if(this.userType==3){return[];}}}
function DUIRegion(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.width=rd.readInt();this.height=rd.readInt();this.longTime=rd.readInt();this.hoverEvent=new DUIDO(rd);this.downEvent=new DUIDO(rd);this.clickEvent=new DUIDO(rd);this.longEvent=new DUIDO(rd);this.leaveEvent=new DUIDO(rd);this.getFiles=function(){return[];}}
function DUIAutoPic(rd){this.base=DUICtrlBase;this.base();delete this.base;this.readBase(rd);this.pic=rd.readString();this.width=rd.readInt();this.height=rd.readInt();this.fuc=rd.readShort();this.zsize=rd.readInt();this.x1=rd.readInt();this.x2=rd.readInt();this.y1=rd.readInt();this.y2=rd.readInt();this.getFiles=function(){return["System/"+this.pic.replace("\\","/")];}}
function DUICtrlBase(rd){this.key="";this.level=0;this.msg="";this.viewportKey="";this.defShow=false;this.showIf=null;this.reference="";this.HAlign=0;this.VAlign=0;this.pointUserValue=false;this.x=0;this.y=0;this.zoomX=100;this.zoomY=100;this.angle=0;this.opacity=255;var _sf=this;this.readBase=function(rd){_sf.key=rd.readString();_sf.level=rd.readInt();_sf.msg=rd.readString();_sf.viewportKey=rd.readString();_sf.defShow=rd.readBool();_sf.showIf=new DIf(rd);_sf.reference=rd.readString();_sf.HAlign=rd.readShort();_sf.VAlign=rd.readShort();_sf.pointUserValue=rd.readBool();_sf.x=rd.readInt();_sf.y=rd.readInt();_sf.zoomX=rd.readShort();_sf.zoomY=rd.readShort();_sf.angle=rd.readShort();_sf.opacity=rd.readShort();};this.HPointUI=function(w,rect){var x=0;var tempX=0;if(this.pointUserValue){var value=RV.GameData.getValue(this.x,0);if(value!=null){tempX=value;}}else{tempX=this.x;}
if(this.reference==""&&this.viewportKey==""){if(this.HAlign==0){x=tempX;}else if(this.HAlign==1){x=(RV.NowProject.gameWidth-w)/2+tempX;}else{x=(RV.NowProject.gameWidth-w)+tempX;}}else{if(this.HAlign==0){x=rect.x+tempX;}else if(this.HAlign==1){x=rect.x+(rect.width-w)/2+tempX;}else{x=rect.x+(rect.width-w)+tempX;}}
return x;};this.VPointUI=function(h,rect){var y=0;var tempY=0;if(this.pointUserValue){var value=RV.GameData.getValue(this.y,0);if(value!=null){tempY=value;}}else{tempY=this.y;}
if(this.reference==""&&this.viewportKey==""){if(this.VAlign==0){y=tempY;}else if(this.VAlign==1){y=(RV.NowProject.gameHeight-h)/2+tempY;}else{y=(RV.NowProject.gameHeight-h)+tempY;}}else{if(this.VAlign==0){y=rect.y+tempY;}else if(this.VAlign==1){y=rect.y+(rect.height-h)/2+tempY;}else{y=rect.y+(rect.height-h)+tempY;}}
return y;}}
DUI.DrawTextSize=function(string,isAutoL,size){var maxW=0;var maxH=0;var text=RF.TextAnalysis(string);var now_x=0;var now_y=0;var fontsize=16;var lineSize=IFont.getHeight("",fontsize);while(true){if(text.length<=0){break;}
var min=text.substring(0,1);text=text.substring(1);var c=min.charCodeAt(0);if(c==60000){now_x=0;lineSize=IFont.getHeight("",fontsize)*1.2;now_y+=lineSize;maxH+=lineSize;}else if(c==60001){var rs=RF.TextToTemp(text,"[","]","\\[([0-9]+[，,][0-9]+[，,][0-9]+)]");text=rs[1];}else if(c==60002){rs=RF.TextToTemp(text,"[","]","\\[([0-9]+)]");fontsize=parseInt(rs[0]);text=rs[1];}else if(c==60003){rs=RF.TextToTemp(text,"[","]","\\[([\\w/.]+)]");}else if(c==60004){var returnS=RF.TextToTemp(text,"[","]","\\[([a-zA-Z0-9-_]+)]");text=RV.GameData.getValues(parseInt(returnS[0]))+returnS[1];}else{var yy=now_y;now_x+=IFont.getWidth(min,fontsize);if(maxW<now_x){maxW=now_x;}
if(maxH<now_y+IFont.getHeight(min,fontsize)){maxH=now_y+IFont.getHeight(min,fontsize);}
if(isAutoL&&now_x>=size){text=RF.CharToAScII(60000)+text;}}}
if(maxW<1)maxW=1;if(maxH<1)maxH=1;return{width:maxW,height:maxH};};function UButton(bmp1,bmp2,viewport){var image=[];var enableBitmap=null;var back=null;var draw1=null;var name="";var enable=false;var mouseOn=false;this.tag=null;var isMoved=false;var x=0;var y=0;var z=0;var zoomX=0;var zoomY=0;var opacity=0;var type=-1;var sNum=1.0;var oldZoom;this.drawTitle=function(str,x,y){draw1.drawText(str,x,y);};var _sf=this;if(viewport==undefined){viewport=null;}
image[0]=bmp1;image[1]=bmp2;var rect=new IRect(0,0,1,1);Object.defineProperty(this,"onload",{set:function(fc){draw1=new ISprite(IBitmap.CBitmap(back.width,back.height),viewport);fc(_sf);}});back=new ISprite(image[0],viewport);enable=true;this.z=0;this.setBitmap=function(bmp1,bmp2,dispose){if(dispose){image[0]=null;image[1]=null;}
image[0]=bmp1;image[1]=bmp2;back.setBitmap(image[0]);isMoved=false;};this.getText=function(){return draw1;};this.dispose=function(){if(draw1!=null)draw1.dispose();if(image[0]!=null){image[0]=null;}
if(image[1]!=null){image[1]=null;}
if(enableBitmap!=null){enableBitmap=null;}
image=[];back.dispose();};this.disposeMin=function(){if(draw1!=null)draw1.dispose();back.disposeMin();};this.isSelected=function(){return back.isSelected();};this.setEnableBitmap=function(bmp){enableBitmap=bmp;};this.setEnable=function(b){if(enableBitmap==null)return;if(enable==b)return;enable=b;if(!b){back.setBitmap(enableBitmap);}else{back.setBitmap(image[0]);}
isMoved=false;};this.getEnable=function(){return enable;};this.isClick=function(){if(!back.visible)return false;if(!enable)return false;return back.isSelectTouch()==2;};this.isDown=function(){return back.isSelected()&&IInput.up;};this.isOn=function(){return mouseOn;};this.cancelSelect=function(){if(!mouseOn)return;mouseOn=false;var bmp=image[mouseOn?1:0];if(bmp!=back.getBitmap()){back.setBitmap(bmp);}};this.getBack=function(){return back;};this.getX=function(){return back.x;};this.getY=function(){return back.y;};this.getZ=function(){return back.z;};this.setX=function(x){back.x=x;if(draw1!=null)draw1.x=x;};this.setY=function(y){back.y=y;if(draw1!=null)draw1.y=y;};this.setZ=function(z){back.z=z;if(draw1!=null)draw1.z=z+1;};this.setZoomX=function(x){back.zoomX=x;if(draw1!=null)draw1.zoomX=x;};this.setZoomY=function(y){back.zoomY=y;if(draw1!=null)draw1.zoomY=y;};this.setVisible=function(v){back.visible=v;if(draw1!=null)draw1.visible=v;};this.getWidth=function(){return back.width*back.zoomX;};this.getHeight=function(){return back.height*back.zoomY;};this.setOpactiy=function(o){back.opacity=o;if(draw1!=null)draw1.opacity=o;};Object.defineProperty(this,"x",{get:function(){return back.x;},set:function(value){back.x=value;if(draw1!=null)draw1.x=value;}});Object.defineProperty(this,"y",{get:function(){return back.y;},set:function(value){back.y=value;if(draw1!=null)draw1.y=value;}});Object.defineProperty(this,"z",{get:function(){return back.z;},set:function(value){back.z=value;if(draw1!=null)draw1.z=value+1;}});Object.defineProperty(this,"zoomX",{get:function(){return back.zoomX;},set:function(value){back.zoomX=value;if(draw1!=null)draw1.zoomX=value;}});Object.defineProperty(this,"zoomY",{get:function(){return back.zoomY;},set:function(value){back.zoomY=value;if(draw1!=null)draw1.zoomY=value;}});Object.defineProperty(this,"visible",{get:function(){return back.visible;},set:function(value){back.visible=value;if(draw1!=null)draw1.visible=value;}});Object.defineProperty(this,"opacity",{get:function(){return back.opacity;},set:function(value){back.opacity=value;if(draw1!=null)draw1.opacity=value;}});Object.defineProperty(this,"width",{get:function(){return back.width*back.zoomX;},set:function(value){}});Object.defineProperty(this,"height",{get:function(){return back.height*back.zoomY;},set:function(value){}});Object.defineProperty(this,"angle",{get:function(){return back.angle;},set:function(value){back.angle=value;if(draw1!=null)draw1.angle=value;}});this.GetRect=function(){rect.left=_sf.getX();rect.top=_sf.getY();rect.right=_sf.getX()+_sf.getWidth();rect.bottom=_sf.getY()+_sf.getHeight();return rect;};this.fade=function(bo,eo,frame){back.fade(bo,eo,frame);if(draw1!=null)draw1.fade(bo,eo,frame);};this.fadeTo=function(o,frame){back.fadeTo(o,frame);if(draw1!=null)draw1.fadeTo(o,frame);};this.slide=function(bx,by,ex,ey,frame){back.slide(bx,by,ex,ey,frame);if(draw1!=null)draw1.slide(bx,by,ex,ey,frame);};this.slideTo=function(x,y,frame){back.slideTo(x,y,frame);if(draw1!=null)draw1.slideTo(x,y,frame);};this.scale=function(bzx,bzy,ezx,ezy,frame){back.scale(bzx,bzy,ezx,ezy,frame);if(draw1!=null)draw1.scale(bzx,bzy,ezx,ezy,frame);};this.scaleTo=function(zx,zy,frame){back.scaleTo(zx,zy,frame);if(draw1!=null)draw1.scaleTo(zx,zy,frame);};this.rotateTo=function(eAngle,frames){back.rotateTo(eAngle,frames);if(draw1!=null)draw1.rotateTo(eAngle,frames);};this.setAction=function(action,args){if(draw1!=null)draw1.addAction.apply(draw1,arguments);};this.setActLoop=function(loop){back.actionLoop=loop;if(draw1!=null)draw1.actionLoop=loop;};this.getActLoop=function(){return back.actionLoop;};this.setMoved=function(b){isMoved=b;};this.update=function(){if(!enable)return false;if(!back.visible)return false;var stutas=back.isSelectTouch();if(stutas==2){return true;}
mouseOn=isMoved||stutas==1;var bmp=image[mouseOn?1:0];if(bmp!=back.getBitmap()){back.setBitmap(bmp);}
return false;};}
function UCheck(baseZ,data,view,_sf,obj){this.data=data;this.index=data.defIndex;var x=0;var y=0;var z=0;var dx=data.dx;var dy=data.dy;var zoomX=1;var zoomY=1;var opacity=1;var angle=0;var visible=true;var checks=[];var files=data.getFiles();var bmp1=RF.LoadCache(files[0]);var bmp2=RF.LoadCache(files[1]);var bmp3=RF.LoadCache(files[2]);var ck=this;var rect=new IRect(0,0,1,1);var slideFrames=0;var endX=0;var endY=0;var diffX=0;var diffY=0;var tmpX=0;var tmpY=0;data.showIf.setOutData(_sf,obj);for(var i=0;i<data.checks.length;i++){var min=data.checks[i];var sp=new ISprite(i==data.defIndex?bmp2:bmp1,view);sp.indexCode=i;sp.enable=true;if(files[2]!="System/"){sp.enableBitmap=bmp3;}
var td=min.text;var dText="";if(td.textType==2){dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+eval(td.text);}else{dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+td.getDrawText();}
var size=DUI.DrawTextSize(dText,false,0);var tx=DUI.HPoint(td.x,td.HAlign,sp.width,size.width);var ty=DUI.VPoint(td.y,td.VAlign,sp.height,size.height);sp.drawText(dText,tx,ty,td.textStyle,td.textStyleColor.IColor(),false,0);sp.tag=dText;sp.z=baseZ+data.level;z=data.level;zoomY=sp.zoomX=data.zoomX/100;zoomX=sp.zoomY=data.zoomY/100;opacity=sp.opacity=data.opacity/255;angle=sp.angle=data.angle;min.enableIf.setOutData(_sf,obj);setEnableMin(sp,min.enableIf.result());visible=sp.visible=data.showIf.result();if(visible){sp.visible=min.visible;}
checks.push(sp);}
Object.defineProperty(this,"x",{get:function(){return x;},set:function(value){x=value;var index=0;for(var i=0;i<checks.length;i++){checks[i].x=x+this.dx*index;index+=1;}}});Object.defineProperty(this,"y",{get:function(){return y;},set:function(value){y=value;var index=0;for(var i=0;i<checks.length;i++){checks[i].y=y+dy*index;index+=1;}}});Object.defineProperty(this,"dx",{get:function(){return dx;},set:function(value){dx=value;var index=0;for(var i=0;i<checks.length;i++){checks[i].x=x+dx*index;index+=1;}}});Object.defineProperty(this,"dy",{get:function(){return dy;},set:function(value){dy=value;var index=0;for(var i=0;i<checks.length;i++){checks[i].y=y+dy*index;index+=1;}}});Object.defineProperty(this,"z",{get:function(){return z;},set:function(value){z=value;for(var i=0;i<checks.length;i++){checks[i].z=z;}}});Object.defineProperty(this,"zoomX",{get:function(){return zoomX;},set:function(value){zoomX=value;for(var i=0;i<checks.length;i++){checks[i].zoomX=zoomX;}}});Object.defineProperty(this,"zoomY",{get:function(){return zoomY;},set:function(value){zoomY=value;for(var i=0;i<checks.length;i++){checks[i].zoomY=zoomY;}}});Object.defineProperty(this,"visible",{get:function(){return visible;},set:function(value){visible=value;for(var i=0;i<checks.length;i++){if(data.checks[i].visible)checks[i].visible=visible;}}});Object.defineProperty(this,"opacity",{get:function(){return opacity;},set:function(value){opacity=value;for(var i=0;i<checks.length;i++){checks[i].opacity=opacity;}}});Object.defineProperty(this,"width",{get:function(){var w=0;for(var i=0;i<checks.length;i++){var tw=(checks[i].x+checks[i].width*checks[i].zoomX)-x;if(checks[i].visible&&tw>w)w=tw;}
return w;},set:function(value){}});Object.defineProperty(this,"height",{get:function(){var h=0;for(var i=0;i<checks.length;i++){var th=(checks[i].y+checks[i].height*checks[i].zoomY)-y;if(checks[i].visible&&th>h)h=th;}
return h;},set:function(value){}});Object.defineProperty(this,"angle",{get:function(){return angle;},set:function(value){angle=value;for(var i=0;i<checks.length;i++){checks[i].angle=angle;}}});this.GetRect=function(){rect.left=ck.x;rect.top=ck.y;rect.right=ck.x+ck.width;rect.bottom=ck.y+ck.height;return rect;};this.fadeTo=function(o,frame){for(var i=0;i<checks.length;i++){checks[i].fadeTo(o,frame);}};this.slideTo=function(eX,eY,frames){this.slide(ck.x,ck.y,eX,eY,frames);};this.scaleTo=function(zx,zy,frame){for(var i=0;i<checks.length;i++){checks[i].scaleTo(zx,zy,frame);}};this.rotateTo=function(eAngle,frames){for(var i=0;i<checks.length;i++){checks[i].rotateTo(eAngle,frames);}};function setEnableMin(sp,b){if(sp.enableBitmap==null)return;if(sp.enable==b)return;sp.enable=b;if(!b){sp.setBitmap(bmp3);}else{sp.setBitmap(sp.indexCode==ck.index?bmp2:bmp1);}}
function updateSlide(){if(slideFrames<=0)return;slideFrames-=1;if(slideFrames<=0){ck.x=endX;ck.y=endY;}else{tmpX+=diffX;tmpY+=diffY;ck.x=tmpX;ck.y=tmpY;}}
this.slide=function(bX,bY,eX,eY,frames){if(frames<=0){ck.x=eX;ck.y=eY;}else{slideFrames=frames;endX=eX;endY=eY;diffX=((endX-bX)/parseFloat(frames));diffY=(endY-bY)/parseFloat(frames);tmpX=bX;tmpY=bY;ck.x=bX;ck.y=bY;}};this.SelectIndex=function(cindex){if(data.checks.length-1<cindex)return;var index=0;var tIndex=-1;for(var i=0;i<checks.length;i++){if(checks[i].visible&&checks[i].enable){checks[i].setBitmap(cindex==index?bmp2:bmp1);var min=data.checks[i];var sp=checks[i];var td=min.text;var dText="";if(td.textType==2){dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+eval(td.text);}else{dText=td.fontColor.TColor()+"\\s["+td.fontSize+"]"+td.getDrawText();}
var size=DUI.DrawTextSize(dText,false,0);var tx=DUI.HPoint(td.x,td.HAlign,sp.width,size.width);var ty=DUI.VPoint(td.y,td.VAlign,sp.height,size.height);checks[i].clearBitmap();sp.drawText(dText,tx,ty,td.textStyle,td.textStyleColor.IColor(),false,0);sp.updateBitmap();sp.tag=dText;if(cindex==index)tIndex=i;}
if(checks[i].visible){index+=1;}}
if(tIndex>=0){ck.index=cindex;if(data.checks[tIndex].changeEvent.eventType==0){if(_sf.getInterpreterMain().isEnd){_sf.getInterpreterMain().addEvents(data.checks[tIndex].changeEvent.eventEvents);}}else if(data.checks[tIndex].changeEvent.eventType==1){eval(data.checks[tIndex].changeEvent.eventScript);}}else{ck.index=-1;}};this.DoAction=function(cindex){if(data.checks.length-1<cindex)return;if(!checks[cindex].enable)return;if(ck.index==cindex){var tIndex=-1;var index=0;for(var i=0;i<checks.length;i++){if(checks[i].visible){if(cindex==index)tIndex=i;index+=1;}}
if(data.checks[tIndex].overEvent.eventType==0){if(_sf.getInterpreterMain().isEnd){_sf.getInterpreterMain().addEvents(data.checks[tIndex].overEvent.eventEvents);}}else if(data.checks[tIndex].overEvent.eventType==1){eval(data.checks[tIndex].overEvent.eventScript);}}else{ck.SelectIndex(cindex);}};this.getMax=function(){var max=0;for(var i=0;i<checks.length;i++){if(checks[i].visible){max+=1;}}
return max;};this.update=function(){updateSlide();ck.visible=data.showIf.result();if(!ck.visible)return;var index=0;for(var i=0;i<checks.length;i++){var min=data.checks[i];setEnableMin(checks[i],min.enableIf.result());if(checks[i].visible)index+=1;if(!checks[i].enable)continue;if(min.text.isAutoUpdate){var dText="";if(min.text.textType==2){dText=min.text.fontColor.TColor()+"\\s["+min.text.fontSize+"]"+eval(min.text.text);}else{dText=min.text.fontColor.TColor()+"\\s["+min.text.fontSize+"]"+min.text.getDrawText();}
if(dText!=checks[i].tag){var size=DUI.DrawTextSize(dText,false,0);var x=DUI.HPoint(min.text.x,min.text.HAlign,checks[i].width,size.width);var y=DUI.VPoint(min.text.y,min.text.VAlign,checks[i].height,size.height);checks[i].clearBitmap();checks[i].drawText(dText,x,y,ctrl.data.text.textStyle,ctrl.data.text.textStyleColor.IColor(),false,0);checks[i].tag=dText;}}
if(checks[i].isSelected()&&IInput.up){if(checks[i].visible){ck.DoAction(index-1);}
return;}}};this.dispose=function(){for(var i=0;i<checks.length;i++){checks[i].disposeMin();}};this.getSprite=function(index){return checks[index];}}
function UAutoPic(baseZ,data,view){var x=0;var y=0;var z=0;var w=data.width;var h=data.height;var visible=true;var opacity=1;var files=data.getFiles();var bitmap=RF.LoadCache(files[0]);var cofs=[];var rect=new IRect(0,0,1,1);var slideFrames=0;var endX=0;var endY=0;var diffX=0;var diffY=0;var tmpX=0;var tmpY=0;var _sf=this;var sps=[];if(bitmap.complete){initPic();}else{if(bitmap.onload==null){bitmap.onload=function(){initPic();}}else{var tempOnload=bitmap.onload;bitmap.onload=function(){tempOnload();initPic();}}}
function initPic(){if(data.fuc==0){cofs[0]=new IBCof(bitmap,0,0,data.zsize,data.zsize);cofs[1]=new IBCof(bitmap,data.zsize,0,bitmap.width-(data.zsize*2),data.zsize);cofs[2]=new IBCof(bitmap,bitmap.width-data.zsize,0,data.zsize,data.zsize);cofs[3]=new IBCof(bitmap,0,data.zsize,data.zsize,bitmap.height-(data.zsize*2));cofs[4]=new IBCof(bitmap,bitmap.width-data.zsize,data.zsize,data.zsize,bitmap.height-(data.zsize*2));cofs[5]=new IBCof(bitmap,0,bitmap.height-data.zsize,data.zsize,data.zsize);cofs[6]=new IBCof(bitmap,bitmap.width-data.zsize,bitmap.height-data.zsize,data.zsize,data.zsize);cofs[7]=new IBCof(bitmap,data.zsize,bitmap.height-data.zsize,bitmap.width-(data.zsize*2),data.zsize);cofs[8]=new IBCof(bitmap,data.zsize,data.zsize,bitmap.width-(data.zsize*2),bitmap.height-(data.zsize*2));}else{cofs[0]=new IBCof(bitmap,0,0,data.x1,data.y1);cofs[1]=new IBCof(bitmap,data.x1,0,bitmap.width-(data.x1+data.x2),data.y1);cofs[2]=new IBCof(bitmap,bitmap.width-data.x2,0,data.x2,data.y1);cofs[3]=new IBCof(bitmap,0,data.y1,data.x1,bitmap.height-(data.y1+data.y2));cofs[4]=new IBCof(bitmap,bitmap.width-data.x2,data.y1,data.x2,bitmap.height-(data.y1+data.y2));cofs[5]=new IBCof(bitmap,0,bitmap.height-data.y2,data.x1,data.y2);cofs[6]=new IBCof(bitmap,bitmap.width-data.x2,bitmap.height-data.y2,data.x2,data.y2);cofs[7]=new IBCof(bitmap,data.x1,bitmap.height-data.y2,bitmap.width-(data.x1+data.x2),data.y2);cofs[8]=new IBCof(bitmap,data.x1,data.y1,bitmap.width-(data.x1+data.x2),bitmap.height-(data.y1+data.y2));}
for(var i=0;i<9;i++){sps[i]=new ISprite(cofs[i],view);}
_sf.x=x;_sf.y=y;_sf.width=w;_sf.height=h;_sf.visible=visible;_sf.z=z;}
this.GetRect=function(){rect.left=_sf.x;rect.top=_sf.y;rect.right=_sf.x+_sf.width;rect.bottom=_sf.y+_sf.height;return rect;};Object.defineProperty(this,"x",{get:function(){return x;},set:function(value){x=value;if(sps.length<=0)return;sps[0].x=x;sps[1].x=x+cofs[0].width;sps[2].x=x+(w-cofs[2].width);sps[3].x=x;sps[4].x=x+(w-cofs[2].width);sps[5].x=x;sps[6].x=x+(w-cofs[2].width);sps[7].x=x+cofs[0].width;sps[8].x=x+cofs[0].width;}});Object.defineProperty(this,"y",{get:function(){return y;},set:function(value){y=value;if(sps.length<=0)return;sps[0].y=y;sps[1].y=y;sps[2].y=y;sps[3].y=y+cofs[0].height;sps[4].y=y+cofs[0].height;sps[5].y=y+(h-cofs[5].height);sps[6].y=y+(h-cofs[5].height);sps[7].y=y+(h-cofs[5].height);sps[8].y=y+cofs[0].height;}});Object.defineProperty(this,"z",{get:function(){return z;},set:function(value){z=value;if(sps.length<=0)return;for(var i=0;i<sps.length;i++){sps[i].z=z;}}});Object.defineProperty(this,"width",{get:function(){return w;},set:function(value){w=value;if(sps.length<=0)return;var minw=w-(cofs[0].width+cofs[2].width);if(minw<0)minw=1;var zoom=minw/cofs[1].width;sps[1].zoomX=zoom;sps[7].zoomX=zoom;sps[8].zoomX=zoom;_sf.x=x;}});Object.defineProperty(this,"height",{get:function(){return h;},set:function(value){h=value;if(sps.length<=0)return;var minh=h-(cofs[0].height+cofs[5].height);if(minh<0)minh=1;var zoom=minh/cofs[3].height;sps[3].zoomY=zoom;sps[4].zoomY=zoom;sps[8].zoomY=zoom;_sf.y=y;}});Object.defineProperty(this,"visible",{get:function(){return visible;},set:function(value){visible=value;if(sps.length<=0)return;for(var i=0;i<sps.length;i++){sps[i].visible=visible;}}});Object.defineProperty(this,"opacity",{get:function(){return opacity;},set:function(value){opacity=value;if(sps.length<=0)return;for(var i=0;i<sps.length;i++){sps[i].opacity=opacity;}}});this.update=function(){updateSlide();};this.slideTo=function(eX,eY,frames){this.slide(_sf.x,_sf.y,eX,eY,frames);};function updateSlide(){if(slideFrames<=0)return;slideFrames-=1;if(slideFrames<=0){_sf.x=endX;_sf.y=endY;}else{tmpX+=diffX;tmpY+=diffY;_sf.x=tmpX;_sf.y=tmpY;}}
this.slide=function(bX,bY,eX,eY,frames){if(frames<=0){_sf.x=eX;_sf.y=eY;}else{slideFrames=frames;endX=eX;endY=eY;diffX=((endX-bX)/parseFloat(frames));diffY=(endY-bY)/parseFloat(frames);tmpX=bX;tmpY=bY;_sf.x=bX;_sf.y=bY;}};this.pauseAnim=function(){for(var i=0;i<sps.length;i++){sps[i].pauseAnim();}};this.addAction=function(action,args){for(var i=0;i<sps.length;i++){sps[i].addAction.apply(sps[i],arguments);}};this.dispose=function(){for(var i=0;i<sps.length;i++){sps[i].disposeMin();}}}
function LCtrlGroup(ui,data,view,z){var _sf=ui;var cg=this;this.data=data;this.ctrlItems=[];var x=-13366758;var y=-13366758;var dx=data.dx;var dy=data.dy;var visible=false;this.width=0;this.height=0;var doif=cg.data.ifs;cg.data.showIf.setOutData(ui,null);var rect=new IRect(0,0,1,1);this.cof=RV.NowUI.ctrls[this.data.id];if(this.cof!=null){var forobj=eval(this.data.obj);var index=0;if(forobj!=null){for(var i in forobj){if(!forobj.hasOwnProperty(i)){continue;}
doif.setOutData(ui,forobj[i]);if(doif.result()){var c=new LCtrl(this.cof,view,ui,forobj[i],cg.data);c.ctrlIndex=index;c.width=this.data.pwidth;c.height=this.data.pheight;this.ctrlItems.push(c);index+=1;}}}}
getSize();Object.defineProperty(this,"x",{get:function(){return x;},set:function(value){if(x!=value){x=value;updatePointMin();}}});Object.defineProperty(this,"y",{get:function(){return y;},set:function(value){if(y!=value){y=value;updatePointMin();}}});Object.defineProperty(this,"visible",{get:function(){return visible;},set:function(value){if(value!=visible){visible=value;for(var i=0;i<cg.ctrlItems.length;i++){cg.ctrlItems[i].visible=visible;}}}});function updatePointMin(){var nowX=x;var nowY=y-dy;for(var i=0;i<cg.ctrlItems.length;i++){if(i%cg.data.column==0){nowY+=dy;nowX=x;}
cg.ctrlItems[i].x=nowX;cg.ctrlItems[i].y=nowY;nowX+=dx;}}
function updatePoint(){var r=LUI.getCtrlRect(cg.data,_sf.ctrlItems,0,0);var r1=cg.GetRect();var endX=r.x+DUI.HPoint(cg.data.x,cg.data.HAlign,r.width,r1.width);var endY=r.y+DUI.VPoint(cg.data.y,cg.data.VAlign,r.height,r1.height);x=endX;y=endY;var nowX=endX;var nowY=endY-dy;for(var i=0;i<cg.ctrlItems.length;i++){if(i%cg.data.column==0){nowY+=dy;nowX=endX;}
cg.ctrlItems[i].x=nowX;cg.ctrlItems[i].y=nowY;nowX+=dx;}}
function getSize(){var nowX=0;var nowY=0-dy;cg.width=0;cg.height=0;for(var i=0;i<cg.ctrlItems.length;i++){if(i%cg.data.column==0){nowY+=dy;nowX=0;}
if(nowX+cg.ctrlItems[i].width>cg.width){cg.width=nowX+cg.ctrlItems[i].width;}
if(nowY+cg.ctrlItems[i].height>cg.height){cg.height=nowY+cg.ctrlItems[i].height;}
nowX+=dx;}}
this.update=function(){cg.visible=cg.data.showIf.result();if(!cg.visible)return;for(var i=0;i<cg.ctrlItems.length;i++){cg.ctrlItems[i].updateNowCtrl();}};this.dispose=function(){for(var i=0;i<cg.ctrlItems.length;i++){cg.ctrlItems[i].disposeNowCtrl();}
cg.ctrlItems.length=0;};this.changeIF=function(newif){cg.dispose();if(this.cof!=null){doif=newif;var forobj=eval(this.data.obj);var index=0;if(forobj!=null){for(var i in forobj){if(!forobj.hasOwnProperty(i)){continue;}
doif.setOutData(ui,forobj[i]);if(doif.result()){var c=new LCtrl(this.cof,view,ui,forobj[i],cg.data);c.ctrlIndex=index;c.width=cg.data.pwidth;c.height=cg.data.pheight;cg.ctrlItems.push(c);index+=1;}}}}
getSize();updatePoint();};this.GetRect=function(){rect.left=cg.x;rect.top=cg.y;rect.right=cg.x+cg.width;rect.bottom=cg.y+cg.height;return rect;};}
function LUI(ui){this.endDo=null;this.data=ui;this.ctrlItems=[];this.ctrlKeys=[];var _sf=this;var setp=0;var childMain=null;var childOther=[];var newCtrl=null;var interpreterMain=new IMain();interpreterMain.ui=this;var interpreterOther=new IMain();interpreterOther.ui=this;if(this.data.scrpit!=""){var args="";if(arguments.length>1){args=arguments[1];}
this.base=eval(this.data.scrpit);if(args.length>0){eval("this.base(ui ,"+args+");");}else{eval("this.base(ui);");}
delete this.base;}
this.getSelfUI=function(id){if(childMain!=null){return childMain;}
for(var i=0;i<childOther.length;i++){if(childOther[i].data.id==id){return childOther[i];}}
return null;};this.showChildfUI=function(ui,args){if(ui!=null){if(ui.isParallel&&_sf.getSelfUI(ui.id)==null){var lui=new LUI(ui,args);lui.endDo=function(){for(var i=0;i<childOther.length;i++){if(childOther[i]==lui){childOther.remove(lui);break;}}};childOther.push(lui);return lui;}else if(!ui.isParallel){childMain=new LUI(ui,args);childMain.endDo=function(){childMain=null;}
return childMain;}}};this.initCtrlPoint=function(ctrl){var rect=LUI.getCtrlRect(ctrl.data,_sf.ctrlItems,0,0);var r1=ctrl.GetRect();ctrl.x=ctrl.data.HPointUI(r1.width,rect);ctrl.y=ctrl.data.VPointUI(r1.height,rect);};this.updateAllPoint=function(ctrls){for(var i=0;i<ctrls.length;i++){if(ctrls[i].data.reference==""&&ctrls[i].data.viewportKey==""){_sf.initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference!=""&&ctrls[i].data.viewportKey==""){_sf.initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference==""&&ctrls[i].data.viewportKey!=""){_sf.initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference!=""&&ctrls[i].data.viewportKey!=""){_sf.initCtrlPoint(ctrls[i]);}}};this.initSelfUIRes=function(){var resList=_sf.data.getFiles();DUI.CacheUIRes(resList,this.initSelfUI);};this.initSelfUI=function(){var tempViews=[];for(var i=0;i<_sf.data.ctrls.length;i++){var ctrl=DUI.LoadCtrls(_sf.data.level,_sf.data.ctrls[i],null,_sf,null);if(ctrl!=null){if(ctrl instanceof IViewport){tempViews.push(ctrl);}else{_sf.ctrlItems.push(ctrl);}
if(ctrl instanceof IScrollbar){updateBar(ctrl);}
_sf.ctrlKeys[_sf.data.ctrls[i].key]=ctrl;}}
_sf.ctrlItems=tempViews.concat(_sf.ctrlItems);_sf.updateAllPoint(_sf.ctrlItems);for(i=0;i<tempViews.length;i++){_sf.updateAllPoint(tempViews[i].ctrls);}
if(_sf.data.initAfterEvent.eventType==0){interpreterMain.addEvents(_sf.data.initAfterEvent.eventEvents);setp=2;}else if(_sf.data.initAfterEvent.eventType==1){eval(_sf.data.initAfterEvent.eventScript);setp=3;}};this.updateUI=function(){if(setp==0&&_sf.data.initEvent.eventType==0){interpreterMain.update();if(interpreterMain.isEnd){setp=1;this.initSelfUIRes();}
return true;}
if(setp==2&&_sf.data.initAfterEvent.eventType==0){interpreterMain.update();if(interpreterMain.isEnd){setp=3;}
return true;}
if(setp==4){for(var i=0;i<childOther.length;i++){childOther[i].updateUI();}
if(_sf.data.closeEvent.eventType==0){interpreterMain.update();}
if(childOther.length<=0&&interpreterMain.isEnd){this.disposeUI();}
return true;}
if(setp==3){if(childMain!=null&&childMain.updateUI())return true;for(i=0;i<childOther.length;i++){childOther[i].updateUI();}
if(_sf.data.isEsc&&IInput.isKeyDown(27)){_sf.closeUI();return true;}
if(_sf.data.isMouse&&IInput.down&&IInput.mouseButton==1){_sf.closeUI();return true;}
interpreterMain.update();if(_sf.data.updateEvent.eventType==0){if(interpreterOther.isEnd){interpreterOther.addEvents(_sf.data.updateEvent.eventEvents)}
interpreterOther.update();}else if(_sf.data.updateEvent.eventType==1){eval(_sf.data.updateEvent.eventScript);}
updateCtlrs(_sf.ctrlItems);}
return true;};function updateCtlrs(ctrls){for(var i=0;i<ctrls.length;i++){var ctrl=ctrls[i];if(ctrl instanceof UButton){updateButton(ctrl);}else if(ctrl instanceof UCheck){ctrl.update();}else if(ctrl instanceof IRect){updateRegion(ctrl);}else if(ctrl instanceof IScrollbar){updateBar(ctrl);}else if(ctrl instanceof IViewport){if(ctrl.updateMove())return;updateView(ctrl);}else if(ctrl.data instanceof DUIText){updateText(ctrl);}else if(ctrl instanceof LCtrl){ctrl.updateNowCtrl();}else if(ctrl instanceof LCtrlGroup){ctrl.update();}else if(ctrl.data instanceof DUIPic){ctrl.visible=ctrl.data.showIf.result();}else if(ctrl instanceof UAutoPic){ctrl.visible=ctrl.data.showIf.result();ctrl.update();}}}
function updateText(ctrl){ctrl.visible=ctrl.data.showIf.result();if(ctrl.data.isAutoUpdate){var dText="";if(ctrl.data.textType==2){dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+eval(ctrl.data.text);}else{dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+ctrl.data.getDrawText();}
if(dText!=ctrl.tag){LUI.setText(ctrl,dText);}}}
function updateView(ctrl){ctrl.visible=ctrl.data.showIf.result();updateCtlrs(ctrl.ctrls);}
function updateBar(ctrl){ctrl.visible=ctrl.data.showIf.result();var min=0;var max=0;if(ctrl.data.userValue==0){min=parseInt(RV.GameData.getValue(ctrl.data.minValue,0));max=parseInt(RV.GameData.getValue(ctrl.data.maxValue,0));}else if(ctrl.data.userValue==1){min=parseInt(eval(ctrl.data.min));max=parseInt(eval(ctrl.data.max));if(max<=0)max=1;}
ctrl.setValue(min,max);ctrl.update();}
function updateRegion(ctrl){ctrl.tempRect.left=IInput.x;ctrl.tempRect.top=IInput.y;ctrl.tempRect.right=IInput.x+1;ctrl.tempRect.bottom=IInput.y+1;var isIn=ctrl.intersects(ctrl.tempRect);if(isIn&&ctrl!=newCtrl){newCtrl=ctrl;if(ctrl.data.hoverEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.hoverEvent.eventEvents);}}else if(ctrl.data.hoverEvent.eventType==1){eval(ctrl.data.hoverEvent.eventScript);}}else if(!isIn&&ctrl==newCtrl){newCtrl=null;if(ctrl.data.leaveEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.leaveEvent.eventEvents);}}else if(ctrl.data.leaveEvent.eventType==1){eval(ctrl.data.leaveEvent.eventScript);}}
if(isIn&&IInput.down){if(ctrl.long<ctrl.data.longTime){ctrl.long+=1;if(ctrl.long==ctrl.data.longTime){if(ctrl.data.longEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.longEvent.eventEvents);}}else if(ctrl.data.longEvent.eventType==1){eval(ctrl.data.longEvent.eventScript);}
ctrl.long+=1;}}
if(ctrl.data.downEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.downEvent.eventEvents);}}else if(ctrl.data.downEvent.eventType==1){eval(ctrl.data.downEvent.eventScript);}}
if(isIn&&IInput.up){if(ctrl.data.clickEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.clickEvent.eventEvents);}}else if(ctrl.data.clickEvent.eventType==1){eval(ctrl.data.clickEvent.eventScript);}}
if(IInput.up){ctrl.long=0;}}
function updateButton(ctrl){ctrl.visible=ctrl.data.showIf.result();ctrl.setEnable(ctrl.data.enableIF.result());if(ctrl.data.text.isAutoUpdate){var dText="";if(ctrl.data.text.textType==2){dText=ctrl.data.text.fontColor.TColor()+"\\s["+ctrl.data.text.fontSize+"]"+eval(ctrl.data.text.text);}else{dText=ctrl.data.text.fontColor.TColor()+"\\s["+ctrl.data.text.fontSize+"]"+ctrl.data.text.getDrawText();}
if(dText!=ctrl.getText().tag){var size=DUI.DrawTextSize(dText,false,0);var x=DUI.HPoint(ctrl.data.text.x,ctrl.data.text.HAlign,ctrl.getBack().width,size.width);var y=DUI.VPoint(ctrl.data.text.y,ctrl.data.text.VAlign,ctrl.getBack().height,size.height);ctrl.getText().clearBitmap();ctrl.getText().drawText(dText,x,y,ctrl.data.text.textStyle,ctrl.data.text.textStyleColor.IColor(),false,0);ctrl.getText().tag=dText;}}
if(ctrl.update()){if(ctrl.data.clickEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.clickEvent.eventEvents);}}else if(ctrl.data.clickEvent.eventType==1){eval(ctrl.data.clickEvent.eventScript);}}
if(ctrl.getBack().isSelectTouch()==1){if(ctrl!=newCtrl){newCtrl=ctrl;if(ctrl.data.hoverEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.hoverEvent.eventEvents);}}else if(ctrl.data.hoverEvent.eventType==1){eval(ctrl.data.hoverEvent.eventScript);}}}else if(newCtrl==ctrl){newCtrl=null;if(ctrl.data.leaveEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.leaveEvent.eventEvents);}}else if(ctrl.data.leaveEvent.eventType==1){eval(ctrl.data.leaveEvent.eventScript);}}
if(ctrl.getBack().isSelectTouch()==1&&IInput.down){if(ctrl.data.downEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.downEvent.eventEvents);}}else if(ctrl.data.downEvent.eventType==1){eval(ctrl.data.downEvent.eventScript);}}}
this.disposeUI=function(){setp=5;if(this.endDo!=null){this.endDo();}};this.closeUI=function(){setp=4;for(var i=0;i<childOther.length;i++){childOther[i].closeUI();}
if(_sf.data.closeEvent.eventType==0){interpreterMain.addEvents(_sf.data.closeEvent.eventEvents)}else if(_sf.data.closeEvent.eventType==1){eval(_sf.data.closeEvent.eventScript);}};this.disposeAll=function(){if(childMain!=null){childMain.disposeAll();}
for(var i=0;i<childOther.length;i++){childOther[i].disposeAll();}
childMain=null;childOther.length=0;LUI.DisposeCtrl(this.ctrlItems);this.ctrlKeys={};};this.getInterpreterMain=function(){return interpreterMain;};if(this.data.initEvent.eventType==0){interpreterMain.addEvents(this.data.initEvent.eventEvents)}else if(this.data.initEvent.eventType==1){eval(this.data.initEvent.eventScript);this.initSelfUIRes();}}
function LCtrl(data,view,ui,obj,rdata){this.ui=ui;this.cof=data;this.data=rdata;this.obj=obj;this.ctrlItems=[];this.ctrlKeys=[];var x=0;var y=0;var visible=true;this.width=0;this.height=0;var rect=new IRect(0,0,1,1);var _sf=this;var setp=0;var newCtrl=null;var interpreterMain=new IMain();interpreterMain.ui=ui;interpreterMain.ctrl=_sf;var interpreterOther=new IMain();interpreterOther.ui=ui;interpreterOther.ctrl=_sf;if(this.cof.script!=""){var args="";if(arguments.length>1){args=arguments[1];}
this.base=eval(this.cof.script);eval("this.base(ui , _sf , obj);");delete this.base;}
this.initSelfUIRes=function(){var resList=_sf.cof.getFiles();DUI.CacheUIRes(resList,this.initSelfUI);};this.initSelfUI=function(){var tempViews=[];var z=ui.data.level;if(view!=null){z=0;}
if(_sf.data!=null){visible=_sf.data.showIf.result();}
for(var i=0;i<_sf.cof.ctrls.length;i++){var ctrl=DUI.LoadCtrls(z,_sf.cof.ctrls[i],view,_sf,obj);if(ctrl!=null){if(ctrl instanceof IViewport){tempViews.push(ctrl);}else{_sf.ctrlItems.push(ctrl);}
if(ctrl instanceof IScrollbar){updateBar(ctrl);}
if(!visible)ctrl.visible=false;_sf.ctrlKeys[_sf.cof.ctrls[i].key]=ctrl;}}
_sf.ctrlItems=tempViews.concat(_sf.ctrlItems);_sf.updateAllPoint(_sf.ctrlItems);for(i=0;i<tempViews.length;i++){_sf.updateAllPoint(tempViews[i].ctrls);}
if(_sf.cof.initAfterEvent.eventType==0){interpreterMain.addEvents(_sf.cof.initAfterEvent.eventEvents);setp=2;}else if(_sf.cof.initAfterEvent.eventType==1){eval(_sf.cof.initAfterEvent.eventScript);setp=3;}};function initCtrlPoint(ctrl){var rect=LUI.getCtrlRect(ctrl.data,_sf.ctrlItems,x,y);var tempx=ctrl.data.HPointUI(ctrl.width,rect);var tempy=ctrl.data.VPointUI(ctrl.height,rect);ctrl.x=x+tempx;ctrl.y=y+tempy;if(tempx+ctrl.width>_sf.width){_sf.width=tempx+ctrl.width;}
if(tempy+ctrl.height>_sf.height){_sf.height=tempy+ctrl.height;}}
this.updateAllPoint=function(ctrls){for(var i=0;i<ctrls.length;i++){if(ctrls[i].data.reference==""&&ctrls[i].data.viewportKey==""){initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference!=""&&ctrls[i].data.viewportKey==""){initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference==""&&ctrls[i].data.viewportKey!=""){initCtrlPoint(ctrls[i]);}}
for(i=0;i<ctrls.length;i++){if(ctrls[i].data.reference!=""&&ctrls[i].data.viewportKey!=""){initCtrlPoint(ctrls[i]);}}};this.updateUBaseRelativePoint=function(key){for(var i=0;i<_sf.ctrlItems.length;i++){if(_sf.ctrlItems[i].data.reference==key){initCtrlPoint(_sf.ctrlItems[i]);}}};this.updateNowCtrl=function(){if(_sf.data!=null){_sf.visible=_sf.data.showIf.result();}
if(setp==0&&_sf.cof.initEvent.eventType==0){interpreterMain.update();if(interpreterMain.isEnd){setp=1;this.initSelfUIRes();}
return true;}
if(setp==2&&_sf.cof.initAfterEvent.eventType==0){interpreterMain.update();if(interpreterMain.isEnd){setp=3;}
return true;}
if(setp==3){updateSlide();if(!_sf.visible)return;interpreterMain.update();if(_sf.cof.updateEvent.eventType==0){if(interpreterOther.isEnd){interpreterOther.addEvents(_sf.cof.updateEvent.eventEvents)}
interpreterOther.update();}else if(_sf.cof.updateEvent.eventType==1){eval(_sf.cof.updateEvent.eventScript);}
updateCtlrs(_sf.ctrlItems);}
return true;};function updateCtlrs(ctrls){for(var i=0;i<ctrls.length;i++){var ctrl=ctrls[i];if(ctrl instanceof UButton){updateButton(ctrl);}else if(ctrl instanceof UCheck){ctrl.update();}else if(ctrl instanceof IRect){updateRegion(ctrl);}else if(ctrl instanceof IScrollbar){updateBar(ctrl);}else if(ctrl instanceof IViewport){if(ctrl.updateMove())return;updateView(ctrl);}else if(ctrl.data instanceof DUIText){updateText(ctrl);}else if(ctrl.data instanceof DUIPic){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}}else if(ctrl instanceof UAutoPic){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}
ctrl.update();}}}
function updateText(ctrl){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}
if(ctrl.data.isAutoUpdate){var dText="";if(ctrl.data.textType==2){dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+eval(ctrl.data.text);}else{dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+ctrl.data.getDrawText();}
if(dText!=ctrl.tag){LUI.setText(ctrl,dText);}}}
function updateView(ctrl){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}
updateCtlrs(ctrl.ctrls);}
function updateBar(ctrl){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}
var min=0;var max=0;if(ctrl.data.userValue==0){min=parseInt(RV.GameData.getValue(ctrl.data.minValue,0));max=parseInt(RV.GameData.getValue(ctrl.data.maxValue,1));}else if(ctrl.data.userValue==1){min=parseInt(eval(ctrl.data.min));max=parseInt(eval(ctrl.data.max));if(max<=0)max=1;}
ctrl.setValue(min,max);ctrl.update();}
function updateRegion(ctrl){ctrl.tempRect.left=IInput.x;ctrl.tempRect.top=IInput.y;ctrl.tempRect.right=IInput.x+1;ctrl.tempRect.bottom=IInput.y+1;var isIn=ctrl.intersects(ctrl.tempRect);if(isIn&&ctrl!=newCtrl){newCtrl=ctrl;if(ctrl.data.hoverEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.hoverEvent.eventEvents);}}else if(ctrl.data.hoverEvent.eventType==1){eval(ctrl.data.hoverEvent.eventScript);}}else if(!isIn&&newCtrl==ctrl){newCtrl=null;if(ctrl.data.leaveEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.leaveEvent.eventEvents);}}else if(ctrl.data.leaveEvent.eventType==1){eval(ctrl.data.leaveEvent.eventScript);}}
if(isIn&&IInput.down){if(ctrl.long<ctrl.data.longTime){ctrl.long+=1;if(ctrl.long==ctrl.data.longTime){if(ctrl.data.longEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.longEvent.eventEvents);}}else if(ctrl.data.longEvent.eventType==1){eval(ctrl.data.longEvent.eventScript);}
ctrl.long+=1;}}
if(ctrl.data.downEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.downEvent.eventEvents);}}else if(ctrl.data.downEvent.eventType==1){eval(ctrl.data.downEvent.eventScript);}}
if(isIn&&IInput.up){if(ctrl.data.clickEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.clickEvent.eventEvents);}}else if(ctrl.data.clickEvent.eventType==1){eval(ctrl.data.clickEvent.eventScript);}}
if(IInput.up){ctrl.long=0;}}
function updateButton(ctrl){if(visible){ctrl.data.showIf.setOutData(_sf,obj);ctrl.visible=ctrl.data.showIf.result();}
ctrl.setEnable(ctrl.data.enableIF.result());if(ctrl.data.text.isAutoUpdate){var dText="";if(ctrl.data.text.textType==2){dText=ctrl.data.text.fontColor.TColor()+"\\s["+ctrl.data.text.fontSize+"]"+eval(ctrl.data.text.text);}else{dText=ctrl.data.text.fontColor.TColor()+"\\s["+ctrl.data.text.fontSize+"]"+ctrl.data.text.getDrawText();}
if(dText!=ctrl.getText().tag){var size=DUI.DrawTextSize(dText,false,0);var x=DUI.HPoint(ctrl.data.text.x,ctrl.data.text.HAlign,ctrl.getBack().width,size.width);var y=DUI.VPoint(ctrl.data.text.y,ctrl.data.text.VAlign,ctrl.getBack().height,size.height);ctrl.getText().clearBitmap();ctrl.getText().drawText(dText,x,y,ctrl.data.text.textStyle,ctrl.data.text.textStyleColor.IColor(),false,0);ctrl.getText().tag=dText;}}
if(ctrl.update()){if(ctrl.data.clickEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.clickEvent.eventEvents);}}else if(ctrl.data.clickEvent.eventType==1){eval(ctrl.data.clickEvent.eventScript);}}
if(ctrl.getBack().isSelectTouch()==1){if(ctrl!=newCtrl){newCtrl=ctrl;if(ctrl.data.hoverEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.hoverEvent.eventEvents);}}else if(ctrl.data.hoverEvent.eventType==1){eval(ctrl.data.hoverEvent.eventScript);}}}else if(newCtrl==ctrl){newCtrl=null;if(ctrl.data.leaveEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.leaveEvent.eventEvents);}}else if(ctrl.data.leaveEvent.eventType==1){eval(ctrl.data.leaveEvent.eventScript);}}
if(ctrl.getBack().isSelectTouch()==1&&IInput.down){if(ctrl.data.downEvent.eventType==0){if(interpreterMain.isEnd){interpreterMain.addEvents(ctrl.data.downEvent.eventEvents);}}else if(ctrl.data.downEvent.eventType==1){eval(ctrl.data.downEvent.eventScript);}}}
this.disposeNowCtrl=function(){LUI.DisposeCtrl(_sf.ctrlItems);};this.getInterpreterMain=function(){return interpreterMain;};this.GetRect=function(){rect.left=x;rect.top=y;rect.right=x+_sf.width;rect.bottom=y+_sf.height;return rect;};Object.defineProperty(this,"x",{get:function(){return x;},set:function(value){x=value;_sf.updateAllPoint(_sf.ctrlItems);}});Object.defineProperty(this,"y",{get:function(){return y;},set:function(value){y=value;_sf.updateAllPoint(_sf.ctrlItems);}});Object.defineProperty(this,"visible",{get:function(){return visible;},set:function(value){if(value!=visible){visible=value;for(var i=0;i<_sf.ctrlItems.length;i++){_sf.ctrlItems[i].visible=visible;}}}});if(this.cof.initEvent.eventType==0){interpreterMain.addEvents(this.cof.initEvent.eventEvents)}else if(this.cof.initEvent.eventType==1){eval(this.cof.initEvent.eventScript);this.initSelfUIRes();}
var slideFrames=0;var endX=0;var endY=0;var diffX=0;var diffY=0;var tmpX=0;var tmpY=0;function updateSlide(){if(slideFrames<=0)return;slideFrames-=1;if(slideFrames<=0){_sf.x=endX;_sf.y=endY;}else{tmpX+=diffX;tmpY+=diffY;_sf.x=tmpX;_sf.y=tmpY;}}
this.slideTo=function(eX,eY,frames){this.slide(_sf.x,_sf.y,eX,eY,frames);};this.slide=function(bX,bY,eX,eY,frames){if(frames<=0){_sf.x=eX;_sf.y=eY;}else{slideFrames=frames;endX=eX;endY=eY;diffX=((endX-bX)/parseFloat(frames));diffY=(endY-bY)/parseFloat(frames);tmpX=bX;tmpY=bY;_sf.x=bX;_sf.y=bY;}};}
LUI.setText=function(ctrl,text){var ls=1.2;if(ctrl.data.lineHeight!=null){ls=ctrl.data.lineHeight}
var size=ISprite.getDrawTextSize(text,ctrl.data.isAutoLine,ctrl.data.lineSize,ls);ctrl.disposeBitmap();ctrl.setBitmap(IBitmap.CBitmap(size.width,size.height));ctrl.width=size.width;ctrl.height=size.height;ctrl.drawText(text,0,0,ctrl.data.textStyle,ctrl.data.textStyleColor.IColor(),ctrl.data.isAutoLine,ctrl.data.lineSize);ctrl.tag=text;};LUI.getCtrlRect=function(data,ctrls,x,y){if(data.viewportKey==""){if(data.reference=="")return new IRect(0,0,RV.NowProject.gameWidth,RV.NowProject.gameHeight);for(var i=0;i<ctrls.length;i++){if(ctrls[i].data.key==data.reference){var r=ctrls[i].GetRect();r.x-=x;r.y-=y;return r;}}}else{var bs=LUI.findCtrlForKey(ctrls,data.viewportKey);if(data.reference==""){if(bs!=null&&bs instanceof IViewport){return new IRect(0,0,bs.GetRect().width,bs.GetRect().height);}}else{if(bs!=null&&bs instanceof IViewport){var vp=bs;for(i=0;i<vp.ctrls.length;i++){if(vp.ctrls[i].data.key==data.reference){return vp.ctrls[i].GetRect();}}}}}
return new IRect(0,0,RV.NowProject.gameWidth,RV.NowProject.gameHeight);};LUI.findCtrlForKey=function(ctrls,key){for(var i=0;i<ctrls.length;i++){if(ctrls[i].data.key==key){return ctrls[i];}}
return null;};LUI.DisposeCtrl=function(ctrls){for(var i=0;i<ctrls.length;i++){var ctrl=ctrls[i];if(ctrl instanceof UButton){ctrl.disposeMin();}else if(ctrl instanceof UCheck){ctrl.dispose();}else if(ctrl instanceof IRect){}else if(ctrl instanceof IScrollbar){ctrl.disposeMin();}else if(ctrl instanceof IViewport){LUI.DisposeCtrl(ctrl.ctrls);ctrl.dispose();}else if(ctrl.data instanceof DUIText){ctrl.dispose();}else if(ctrl instanceof LCtrl){ctrl.disposeNowCtrl();}else if(ctrl.data instanceof DUIPic){if(ctrl.canDispose){ctrl.dispose();}else{ctrl.disposeMin();}}else if(ctrl.data instanceof DUIAutoPic){ctrl.dispose();}else if(ctrl instanceof LCtrlGroup){ctrl.dispose();}}
ctrls.length=0;};LUI.RePoint=function(ctrl,list,x,y){var r=LUI.getCtrlRect(ctrl.data,list,x,y);var r1=ctrl.GetRect();ctrl.x=ctrl.data.HPointUI(r1.width,r);ctrl.y=ctrl.data.VPointUI(r1.height,r);};LUI.IMSelectCtlr=function(main,key){var ctrl={};if(main.ctrl!=null){var c=main.ctrl.ctrlKeys[key];if(c!=null){ctrl.ctrl=c;ctrl.list=main.ctrl.ctrlItems;ctrl.x=main.ctrl.x;ctrl.y=main.ctrl.y;return ctrl;}}
if(main.ui!=null){c=main.ui.ctrlKeys[key];if(c!=null){ctrl.ctrl=c;ctrl.list=main.ui.ctrlItems;ctrl.x=0;ctrl.y=0;return ctrl;}}
ctrl.ctrl=null;ctrl.list=null;ctrl.x=0;ctrl.y=0;return ctrl;};IM.UIMove=function(event,main){this.base=IEventBase;this.base();delete this.base;var wait=0;this.init=function(){var key=event.args[0];var c=LUI.IMSelectCtlr(main,key);var ctrl=c.ctrl;if(ctrl!=null){var w=parseInt(event.args[1]);if(event.args[2]=="1"){wait=w;}}
var x=0;var y=0;if(event.args[3]=="0"){x=parseInt(event.args[4]);y=parseInt(event.args[5]);}else{x=RV.GameData.getValueNum(parseInt(event.args[4]),0);y=RV.GameData.getValueNum(parseInt(event.args[5]),0);}
if(ctrl==null)return false;var r=LUI.getCtrlRect(ctrl.data,c.list,c.x,c.y);var r1=ctrl.GetRect();var endX=r.x+DUI.HPoint(x,ctrl.data.HAlign,r.width,r1.width);var endY=r.y+DUI.VPoint(y,ctrl.data.VAlign,r.height,r1.height);ctrl.slideTo(endX,endY,w);if(ctrl.scaleTo!=null){ctrl.scaleTo(parseInt(event.args[6])/100,parseInt(event.args[7])/100,w);}
if(ctrl.fadeTo!=null){ctrl.fadeTo(parseInt(event.args[8])/255,w);}
if(ctrl.rotateTo!=null){ctrl.rotateTo(parseInt(event.args[9]),w);}
return false;};this.update=function(){wait-=1};this.isFinish=function(){return wait<=0};};IM.UIDisposeCtrl=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var key=event.args[0];var ctrl=null;var ctrls=[];if(main.ctrl!=null){ctrl=main.ctrl.ctrlKeys[key];if(ctrl!=null){ctrls.push(ctrl);LUI.DisposeCtrl(ctrls);delete main.ctrl.ctrlKeys[key];main.ctrl.ctrlItems.remove(ctrl);return;}}
if(main.ui!=null){ctrl=main.ui.ctrlKeys[key];if(ctrl!=null){ctrls.push(ctrl);LUI.DisposeCtrl(ctrls);delete main.ui.ctrlKeys[key];main.ui.ctrlItems.remove(ctrl);return;}}
return false;};};IM.UIDisposeAll=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){if(main.ui!=null){LUI.DisposeCtrl(main.ui.ctrlItems);main.ui.ctrlKeys.length=0;}
return false;};};IM.UICheckIndex=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var key=event.args[0];var index=parseInt(event.args[1]);var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl instanceof UCheck){if(ctrl.index!=index){ctrl.DoAction(index);}}
return false;};};IM.UIPic=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var _sf=null;var obj=null;if(main.ctrl!=null){_sf=main.ctrl;obj=main.ctrl.obj;}
if(main.ctrl==null&&main.ui!=null){_sf=main.ui;}
var key=event.args[0];var type=parseInt(event.args[1]);var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl.data instanceof DUIPic){ctrl.canDispose=false;var bitmap=null;if(type==0){var p="System/"+event.args[2].replace("\\","/");bitmap=RF.LoadCache(p);}else if(type==1){p="System/"+RV.GameData.getValues(parseInt(event.args[2]));bitmap=RF.LoadCache(p);}else if(type==2){bitmap=RF.LoadCache(eval(event.args[2]));}else if(type==3){bitmap=IBitmap.CBitmap(parseInt(event.args[2]),parseInt(event.args[3]));ctrl.canDispose=true;}
if(bitmap.complete){ctrl.setBitmap(bitmap);ctrl.width=bitmap.width;ctrl.height=bitmap.height;}else{bitmap.onload=function(){ctrl.setBitmap(bitmap);ctrl.width=bitmap.width;ctrl.height=bitmap.height;}}}
return false;};};IM.UIAutoPicSize=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var key=event.args[0];var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl instanceof UAutoPic){ctrl.width=parseInt(event.args[1]);ctrl.height=parseInt(event.args[2]);}
return false;};};IM.UITextChange=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var _sf=null;var obj=null;if(main.ctrl!=null){_sf=main.ctrl;obj=main.ctrl.obj;}
if(main.ctrl==null&&main.ui!=null){_sf=main.ui;}
var key=event.args[0];var type=parseInt(event.args[1]);var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl.data instanceof DUIText){var dText="";if(type==2){dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+eval(event.args[2]);}else{dText=ctrl.data.fontColor.TColor()+"\\s["+ctrl.data.fontSize+"]"+this.getDrawText(type,event.args[2]);}
if(dText!=ctrl.tag){LUI.setText(ctrl,dText);}}
return false;};this.getDrawText=function(type,text){var str="";if(type==0){str=RF.MakerValueText(text);}else if(type==1){str=RV.GameData.getValues(parseInt(text));}else{str=eval(text);}
return str;}};IM.UIChangeIF=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var key=event.args[0];var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl instanceof LCtrlGroup){var dif=event2DIF();ctrl.changeIF(dif);}
return false;};function event2DIF(){var evt=event;var dif=new DIf();dif.type=parseInt(evt.args[1]);dif.haveElse=evt.args[2]=="1";for(var i=3;i<evt.args.length;i++){var main=evt.args[i].split('Φ');var difi=new DIfItem();difi.type=parseInt(main[0]);difi.num1Index=parseInt(main[1]);difi.fuc=parseInt(main[2]);difi.type2=parseInt(main[3]);difi.num2=main[4];difi.num2Index=parseInt(main[5]);dif.items.push(difi);}
return dif;}};IM.UICloseUI=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){if(main.ui!=null){main.ui.closeUI();}
return false;};};IM.UIAngel=function(event,main){this.base=IEventBase;this.base();delete this.base;this.init=function(){var _sf=null;var obj=null;if(main.ctrl!=null){_sf=main.ctrl;obj=main.ctrl.obj;}
if(main.ctrl==null&&main.ui!=null){_sf=main.ui;}
var key=event.args[0];var type=parseInt(event.args[1]);var ctrl=LUI.IMSelectCtlr(main,key).ctrl;if(ctrl!=null){if(type==0){ctrl.angle=parseInt(event.args[2]);}else{ctrl.angle=RV.GameData.getValueNum(parseInt(event.args[2]),0);}}
return false;};};